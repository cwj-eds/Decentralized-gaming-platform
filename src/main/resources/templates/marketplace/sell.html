<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上架资产 - 去中心化游戏平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
<nav th:replace="~{layout/nav :: nav}"></nav>

<main class="container py-4">
    <h2 class="mb-4"><i class="fas fa-upload me-2"></i>上架资产</h2>
    <form id="sellForm" class="card p-3">
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">资产类型</label>
                <select class="form-select" id="itemType">
                    <option value="GAME">游戏</option>
                    <option value="AGENT">智能体</option>
                    <option value="GAME_ITEM">游戏道具</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">资产ID</label>
                <input type="number" class="form-control" id="itemId" placeholder="请输入资产ID" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">价格(PLATFORM_TOKEN)</label>
                <input type="number" class="form-control" id="price" min="0" step="0.00000001" placeholder="0" required>
            </div>
        </div>
        <div class="mt-3 d-flex gap-2">
            <button type="submit" class="btn btn-primary"><i class="fas fa-upload me-1"></i>提交上架</button>
            <a class="btn btn-secondary" th:href="@{/marketplace}">返回市场</a>
        </div>
    </form>
</main>

<script th:src="@{/js/main.js}"></script>
<script>
document.getElementById('sellForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const payload = {
        itemType: document.getElementById('itemType').value,
        itemId: Number(document.getElementById('itemId').value),
        price: document.getElementById('price').value,
        currency: 'PLATFORM_TOKEN'
    };
    try{
        const res = await authFetch('/marketplace/api/items',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(payload)
        });
        const body = await res.json();
        if(body && body.code === 0){
            alert('上架成功');
            window.location.href = '/marketplace';
        }else{
            alert(body.message || '上架失败');
        }
    }catch(err){
        alert('网络异常');
    }
});
</script>
</body>
</html>



